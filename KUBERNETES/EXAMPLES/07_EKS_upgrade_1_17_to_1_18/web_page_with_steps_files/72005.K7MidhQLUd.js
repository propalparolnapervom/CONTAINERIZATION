(self._cf=self._cf||[]).push([[72005],{397486:(t,e,i)=>{"use strict";i.d(e,{t:()=>r});class r extends Error{constructor(t){super(t),this.name="ExperienceTimeoutError"}}},810368:(t,e,i)=>{"use strict";i.d(e,{D:()=>I});var r=i(151119),s=i(726426),n=i.n(s),a=i(36200),o=i(991947),c=i(99604),u=i(159394),h=i(391528),d=i(397486),m=i(837464),l=i(536631);class b{constructor(){(0,r.Z)(this,"callbacks",new Map)}start(){let t;document.addEventListener("freeze",(()=>{t=performance.now()})),document.addEventListener("resume",(()=>{if("number"!=typeof t)return;const e=performance.now();for(const i of this.callbacks.values())i(e-t)}))}subscribe(t,e){this.callbacks.set(t,e)}unsubscribe(t){this.callbacks.delete(t)}}const E=(0,l.default)((()=>new b));class p{constructor({name:t,id:e,timeout:i,startTime:s=window.performance.now(),attributes:n,onStart:a,onSuccess:o,onFailure:c,onAbort:d}){(0,r.Z)(this,"name",void 0),(0,r.Z)(this,"id",void 0),(0,r.Z)(this,"timeout",void 0),(0,r.Z)(this,"freezeTime",0),(0,r.Z)(this,"stopState",null),(0,r.Z)(this,"startTime",void 0),(0,r.Z)(this,"attributes",void 0),(0,r.Z)(this,"onStop",void 0),(0,r.Z)(this,"onSuccess",void 0),(0,r.Z)(this,"onFailure",void 0),(0,r.Z)(this,"onAbort",void 0),this.name=t,this.id=e,this.timeout=i,this.startTime=s,this.attributes=n,this.onSuccess=o,this.onFailure=c,this.onAbort=d;const m={action:"taskStart",name:t,id:e,startTime:s,timeout:i,attributes:(0,u.Z)((0,u.Z)({},n),(0,h.aX)())};a&&(this.onStop=a(m)),E().subscribe(t,(t=>{this.freezeTime+=t}))}succeed(t){this.hasStopped||(this.onSuccess&&this.onSuccess(),this.stop({action:"taskSuccess",name:this.name,id:this.id,startTime:this.startTime,duration:this.getAbsoluteDuration(),activeDuration:this.getDurationAdjustedForActive(),adjustedDuration:this.getDurationAdjustedForTabActivity(),attributes:(0,u.Z)((0,u.Z)((0,u.Z)({},this.attributes),t),(0,h.aX)())}))}fail({error:t,attributes:e}){this.hasStopped||(this.onFailure&&this.onFailure(),this.stop({action:"taskFail",name:this.name,id:this.id,startTime:this.startTime,duration:this.getAbsoluteDuration(),activeDuration:this.getDurationAdjustedForActive(),adjustedDuration:this.getDurationAdjustedForTabActivity(),error:t,attributes:(0,u.Z)((0,u.Z)({},this.attributes),e)}))}abort({reason:t,attributes:e,checkForTimeout:i=!0}){if(this.hasStopped)return;const r=this.getDurationAdjustedForTabActivity();i&&null!=this.timeout&&r>=this.timeout?this.fail({attributes:e,error:new d.t(`${this.name} failed to complete in ${this.timeout}ms`)}):(this.onAbort&&this.onAbort(),this.stop({action:"taskAbort",name:this.name,id:this.id,startTime:this.startTime,duration:this.getAbsoluteDuration(),activeDuration:this.getDurationAdjustedForActive(),adjustedDuration:r,reason:t,checkForTimeout:i,attributes:(0,u.Z)((0,u.Z)({},this.attributes),e)}))}stopOn(t){t&&("taskSuccess"===t.action?this.succeed({}):"taskAbort"===t.action?this.abort({reason:t.reason,checkForTimeout:t.checkForTimeout}):"taskFail"===t.action&&this.fail({error:t.error}))}getState(){return{timeout:this.timeout,hasStopped:this.hasStopped,stopState:this.stopState,startTime:this.startTime,name:this.name}}get hasStopped(){return null!==this.stopState}stop(t){this.stopState=t.action,this.onStop&&this.onStop(t),E().unsubscribe(this.name)}getAbsoluteDuration(){return Math.round(window.performance.now()-this.startTime)}getDurationAdjustedForTabActivity(){return this.getAbsoluteDuration()-(0,m.y)().getInactiveMillisecondsSince(this.startTime)}getDurationAdjustedForActive(){return this.getAbsoluteDuration()-this.freezeTime}}class I{constructor(){(0,r.Z)(this,"experiences",{}),(0,r.Z)(this,"subscribers",[]),(0,r.Z)(this,"logger",(0,a.j)("ExperienceTracker")),(0,r.Z)(this,"useImprovedAbortOrder",!1),E().start(),window.addEventListener("pagehide",(()=>{this.abort({reason:"Window unloading"})}))}enableImprovedAborting(){this.useImprovedAbortOrder=!0}start({name:t,id:e=n()(),timeout:i,startTime:r,attributes:s,onSuccess:a,onFailure:o,onAbort:c,collect:u}){const h=this.experiences[t];if(h&&h.id===e)return;h&&h.abort({reason:"Aborted because the same experience was started with a new id"});const d=new p({name:t,id:e,timeout:i,startTime:r,attributes:s,onSuccess:a,onFailure:o,onAbort:c,onStart:t=>{this.emit(t);let e=()=>{};if(u){const t=[];e=this.subscribe((e=>{("taskStart"===e.action||t.some((t=>t.name===e.name&&"taskStart"===t.action)))&&(t.push(e),u(t,d))}))}return t=>{e(),this.emit(t)}}});this.experiences[t]=d}succeed({name:t,attributes:e}){const i=this.experiences[t];i&&i.succeed(e)}fail({name:t,error:e,attributes:i}){Object.values(this.experiences).forEach((r=>{null!=t&&r.name!==t||r.fail({error:e,attributes:i})}))}abort({name:t,reason:e,attributes:i,checkForTimeout:r}){function s(s){null!=t&&s.name!==t||s.abort({reason:e,checkForTimeout:r,attributes:i})}if(this.useImprovedAbortOrder){const t=Object.values(this.experiences).filter((t=>t.timeout)),e=Object.values(this.experiences).filter((t=>!t.timeout));t.forEach(s),e.forEach(s)}else Object.values(this.experiences).forEach(s)}stopOnError({error:t,name:e,attributes:i}){const r=function(t){return(0,o.OG)(t)?`Aborted because of session expiration error: ${t.toString()}`:(0,c.S)(t)?`Aborted because of network error: ${t.toString()}`:void 0}(t);r?this.abort({name:e,reason:r,checkForTimeout:!1,attributes:i}):this.fail({name:e,error:t,attributes:i})}subscribe(t){if("function"!=typeof t)throw new Error("Subscriber must be a function");return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter((e=>e!==t))}}getExperienceState(t){return this.experiences[t]?this.experiences[t].getState():null}emit(t){this.logger.debug`${t.action} ${t}`,this.subscribers.forEach((e=>{try{e(t)}catch(i){this.logger.error`Error occurred in ExperienceTracker subscriber ${i} when handling event ${t}`}}))}}},837464:(t,e,i)=>{"use strict";i.d(e,{y:()=>o});var r=i(151119),s=i(536631),n=i(36200);class a{constructor({maxIntervalsToStore:t}={}){(0,r.Z)(this,"inactivityIntervals",[]),(0,r.Z)(this,"logger",(0,n.j)("TabInactivityTracker")),(0,r.Z)(this,"maxIntervalsToStore",void 0),(0,r.Z)(this,"onVisibilityChange",(()=>{document.hidden?(this.inactivityIntervals.length>=this.maxIntervalsToStore&&this.inactivityIntervals.splice(this.maxIntervalsToStore-1),this.inactivityIntervals.unshift([window.performance.now(),null])):0===this.inactivityIntervals.length||null!=this.inactivityIntervals[0][1]?this.logger.error`Invariant violation: tab is currently active, but inactivity intervals are in inconsistent state`:this.inactivityIntervals[0][1]=window.performance.now()}));this.maxIntervalsToStore="number"==typeof t?t:100}initialize(){return document.hidden&&this.onVisibilityChange(),document.addEventListener("visibilitychange",this.onVisibilityChange),{teardown:()=>{document.removeEventListener("visibilitychange",this.onVisibilityChange)}}}getInactiveMillisecondsSince(t){let e=0;for(const[i,r]of this.inactivityIntervals){const s=r||window.performance.now();if(t>s)break;e+=s-Math.max(i,t)}return e}}const o=(0,s.default)((()=>{const t=new a;return t.initialize(),t}))},772005:(t,e,i)=>{"use strict";i.d(e,{Nq:()=>E,OV:()=>I,Cf:()=>v});var r=i(159394),s=i(454530),n=i(536631),a=i(275392),o=i(389027),c=i(171529),u=i(803894),h=i(810368),d=i(557098),m=i(397486);const l=new Set([d.q.ADD_PAGE_COMMENT,d.q.CREATE_PAGE,d.q.EDIT_PAGE,d.q.VIEW_PAGE]),b=new Set;function E(){return Array.from(b).pop()}function p(t){const{action:e,name:i,id:n,attributes:a}=t,o=(0,s.Z)(t,["action","name","id","attributes"]),c=(0,r.Z)((0,r.Z)((0,r.Z)({},a),o),{},{task:i,taskId:n});if(c.error){let t;t="string"==typeof c.error?new Error(c.error):c.error,delete c.error,c.errorName=t.name,u.K.isBadStatusError(t)&&t.traceId&&(c.traceId=t.traceId),c.errorMessage=t.message}return c.browserInfo=window.navigator.userAgent,c.isActiveTab="visible"===document.visibilityState,c}const I=(0,n.default)((()=>{const t=new h.D;return/bot/i.test(window.navigator.userAgent)||t.subscribe((e=>{!function({action:t,name:e}){l.has(e)&&("taskStart"===t?b.add(e):b.delete(e),(0,o.U)().updateContext({slaExperience:E()}))}(e),(0,a.getAnalyticsWebClient)().then((t=>{t.sendOperationalEvent({source:"ui",actionSubject:"ui",action:e.action,attributes:p(e)})}));const i=[`action:${e.action}`,`isActiveTab:${"visible"===document.visibilityState}`];if(e.attributes)for(const t in e.attributes)i.push(`${t}:${e.attributes[t]}`);(0,o.U)().incrementCounter(`experience-tracker:${e.name}`,i),"taskSuccess"===e.action&&(0,o.U)().submitPerformanceMetric(`experience-tracker:${e.name}`,e.duration,i),"taskFail"===e.action&&l.has(e.name)&&(e.error instanceof m.t||((0,c.NP)(e.error,{failedSlaExperience:e.name}),(0,o.U)().submitError(e.error,{attribution:"sla"}))),e.name===d.q.VIEW_CONTENT&&T(t,e),S(e.name)&&N(t,e)})),t}));function v(t,e,i){I().stopOnError({name:t,error:e,attributes:i})}const f=(t,e,i)=>{switch(e.action){case"taskStart":t.start((0,r.Z)((0,r.Z)({},e),{},{name:i}));break;case"taskSuccess":t.succeed((0,r.Z)((0,r.Z)({},e),{},{name:i}));break;case"taskFail":t.fail((0,r.Z)((0,r.Z)({},e),{},{name:i}));break;case"taskAbort":t.abort((0,r.Z)((0,r.Z)({},e),{},{name:i}))}},T=(t,e)=>{const i=e.attributes&&"space"===e.attributes.contentType?d.q.SPACE_OVERVIEW:d.q.VIEW_PAGE;f(t,e,i)},S=t=>[d.q.ADD_INLINE_COMMENT,d.q.EDIT_INLINE_COMMENT,d.q.REPLY_TO_INLINE_COMMENT,d.q.DELETE_INLINE_COMMENT,d.q.RESOLVE_INLINE_COMMENT,d.q.UNRESOLVE_INLINE_COMMENT].includes(t),N=(t,e)=>{if(!(e.attributes&&"view-all"===e.attributes.mode))return;let i;switch(e.name){case d.q.ADD_INLINE_COMMENT:i=d.q.VIEW_ALL_ADD_INLINE_COMMENT;break;case d.q.EDIT_INLINE_COMMENT:i=d.q.VIEW_ALL_EDIT_INLINE_COMMENT;break;case d.q.REPLY_TO_INLINE_COMMENT:i=d.q.VIEW_ALL_REPLY_TO_INLINE_COMMENT;break;case d.q.DELETE_INLINE_COMMENT:i=d.q.VIEW_ALL_DELETE_INLINE_COMMENT;break;case d.q.RESOLVE_INLINE_COMMENT:i=d.q.VIEW_ALL_RESOLVE_INLINE_COMMENT;break;case d.q.UNRESOLVE_INLINE_COMMENT:i=d.q.VIEW_ALL_UNRESOLVE_INLINE_COMMENT}f(t,e,i||e.name)}},991947:(t,e,i)=>{"use strict";i.d(e,{RX:()=>a,Fo:()=>o,OG:()=>c});var r=i(992873),s=i(803894);const n="Session expired";class a extends s.K{constructor(t,e){super(`${t} Session expired`,e)}}function o(t){var e,i;if(!t)return!1;if(t instanceof a)return!0;if(-1!=((null!=(i=t)?i.message:i)||"").indexOf(n))return!0;return 401==(null!=(e=t)&&null!=(e=e.extensions)?e.statusCode:e)}function c(t){if(!t)return!1;if(o(t))return!0;if((0,r.MS)(t)){const{graphQLErrors:e,networkError:i}=t;if(o(i))return!0;if((e||[]).some(o))return!0}return!1}},391528:(t,e,i)=>{"use strict";i.d(e,{aX:()=>s,V:()=>n});const r={uuid:null,pageId:"",routeName:"",transitionId:0,routingTimestamp:0,currentSavedTimestamp:0},s=()=>(r.currentSavedTimestamp=performance.now(),{uuid:r.uuid,contentId:r.pageId,isInitial:0===r.transitionId,isSSR:Boolean(window.__SSR_RENDERED__),routingDuration:r.currentSavedTimestamp-r.routingTimestamp}),n=(t="",e,i,s)=>{const{contentId:n}=null==e?void 0:e.params,c=s.userId;if(r.pageId!==n||r.routeName!==t){let e;e=c?o(t,n,s):a(),r.uuid=e,r.routeName=t,r.pageId=n,r.transitionId=i,r.routingTimestamp=performance.now()}},a=()=>"10000000-1000-4000-8000-100000000000".replace(/1|0/g,(function(){return(0|16*Math.random()).toString(16)})),o=(t,e,i)=>{const{userId:r,cloudId:s}=i;return`${t=t||"route"}-${e=e||"page"}-${r}-${s}-${Date.now()}`}}}]);
//# sourceMappingURL=72005.K7MidhQLUd.js.map