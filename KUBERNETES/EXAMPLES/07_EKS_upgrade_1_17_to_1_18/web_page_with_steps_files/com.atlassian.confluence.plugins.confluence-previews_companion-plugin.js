WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-previews:companion-plugin', location = 'js/component/companion/companion-plugin.js' */
define("cp/component/companion/companion-plugin",["cp/component/companion/companion-button-view","ADCClient","cp/component/companion/confluence-companion-interface"],function(g,f,h){var j=f.ADCClient;var e=false;var c=new j(h.asapFetcher);var i=true;var a=null;function b(k,l){if(e){return k?k():null}c.connect().then(function(){c.emit("reconnect");e=true;c.once("close",function(){e=false;setTimeout(b,5000)});return k?k():null})["catch"](function(m){if(l&&l>0&&!(m instanceof j.ConnectionLifecycleError)){if(i){a=setTimeout(function(){b(k,l)},l)}else{a=null}}})}var d=function(k){window._mediaViewer=k;k.getView().fileControlsView.addLayerView("companionButton",g,{weight:2,predicate:function(m){return true}});function l(n,o){var m=n.get("title").split(".");var p=m.length>1?m[m.length-1]:null;f.getAppsList(o,n.attributes.originalContentType,p).then(function(q){if(q.length!==0){var r=q[0];g.currentInstance.doneLoading();g.currentInstance.setMeta(k,c,o,n,r);c.on("close",function(){g.currentInstance.clearMeta()})}else{}})}k.on("fv.changeFile",function(m){g.initialFile=m;i=true;function n(o,p){b(function(){c.startTransaction(j.TRANSACTION_TYPES.FILE).then(function(q){c.on("reconnect",function(){c.startTransaction(j.TRANSACTION_TYPES.FILE,q.id).then(function(){l(m,q)})});l(m,q)})},o);c.once("connect-attempt-done",function(){var q=g.currentInstance;if(q){q.doneLoading()}})}g.startPolling=function(){if(i&&a===null){a=true;n(1000);g.stopPolling=function(){clearTimeout(a);a=null}}};n()});k.on("fv.close",function(m){i=false;g.startPolling=null;clearTimeout(a);a=null})};return d});(function(){var b=require("cp/component/companion/companion-plugin");var a=require("MediaViewer");a.registerPlugin("companion",b)})();
}catch(e){WRMCB(e)};