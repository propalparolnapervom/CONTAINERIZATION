(self._cf=self._cf||[]).push([[24963],{35658:(e,t,n)=>{"use strict";n.d(t,{T:()=>A,C7:()=>P,Ag:()=>g,bp:()=>l,uS:()=>u,te:()=>v});var a=n(159394),r=n(202784),o=n(230382),i=n.n(o),c=n(604919);const p=i()`query getDraftContentAppearanceProperty($contentId:ID$status:[String]){content(id:$contentId status:$status){nodes{id ...contentAppearanceDraftFragment}}}${c.t}`,s=i()`query getPublishedContentAppearanceProperty($contentId:ID$status:[String])@SLA{content(id:$contentId status:$status){nodes{id ...contentAppearancePublishedFragment}}}${c.O}`;var d=n(683591);const l=(e,t)=>{const n=e.find((e=>e.key===t&&e.version));let a=d.X.DEFAULT,r=0;return n&&(a=JSON.parse(n.value),r=n.version.number),{appearance:a,version:r}},u=e=>l(e.appearancePublished.nodes,d.q.PUBLISHED),v=async(e,t,n,a)=>{try{return await e(t),y(a,t),t}catch(r){if(409===(null==r?void 0:r.statusCode)){const r=await g(t.contentId,t.propertyKey,n);if(r.version)return t=f(t,r),await e(t),y(a,t),t}throw r}},f=(e,t)=>(e.versionNumber=t.version+1,e.propertyValue!==t.appearance&&(e.propertyValue=t.appearance===d.X.DEFAULT?d.X.FULL_WIDTH:d.X.DEFAULT),e),g=async(e,t,n)=>{var a,r;const o=t===d.q.PUBLISHED?s:p,i=null===(a=(await n.query({query:o,variables:{contentId:e,status:["current","draft"]},fetchPolicy:"network-only",context:{single:"true"}})).data)||void 0===a||null===(r=a.content)||void 0===r?void 0:r.nodes[0];return i?t===d.q.PUBLISHED?u(i):(e=>l(e.appearanceDraft.nodes,d.q.DRAFT))(i):m()},m=()=>({appearance:d.X.DEFAULT,version:0}),P="editorAppearance",y=(e,t)=>{e&&e.sendMessage({type:P,appearance:t.propertyValue,version:t.versionNumber})},A=({children:e,userOffline:t,params:n,apolloClient:o,updateContentAppearanceProperty:i,collabEditProvider:c})=>{const[p,s]=(0,r.useState)(!1),d=async()=>{const e=await g(n.contentId,n.propertyKey,o);await(async(e,t,n,r)=>{const o=(0,a.Z)((0,a.Z)({},t),{},{propertyValue:e.appearance,versionNumber:e.version+1});e.version&&(await n(o),y(r,o))})(e,n,i,c)};return(0,r.useEffect)((()=>{s(!!t)}),[t]),!t&&p&&d(),e}},604919:(e,t,n)=>{"use strict";n.d(t,{O:()=>i,t:()=>c});var a=n(230382),r=n.n(a);const o=r()`fragment contentAppearanceInnerFragment on PaginatedJsonContentPropertyList{nodes{id key value version{number}}}`,i=r()`fragment contentAppearancePublishedFragment on Content{appearancePublished:properties(key:"content-appearance-published"){...contentAppearanceInnerFragment}}${o}`,c=r()`fragment contentAppearanceDraftFragment on Content{appearanceDraft:properties(key:"content-appearance-draft"){...contentAppearanceInnerFragment}}${o}`},683591:(e,t,n)=>{"use strict";let a,r;n.d(t,{q:()=>a,X:()=>r}),function(e){e.PUBLISHED="content-appearance-published",e.DRAFT="content-appearance-draft"}(a||(a={})),function(e){e.DEFAULT="default",e.FULL_WIDTH="full-width"}(r||(r={}))},324963:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ImageWrapper:()=>A,SpinnerWrapper:()=>h,PageCoverPictureViewPageComponent:()=>E,RendererPageCoverPicture:()=>D});var a=n(547313),r=n(202784),o=n(286235),i=n(896159),c=n(175612),p=n(248463),s=n(267083),d=n(165929),l=n(846575),u=n(683591),v=n(35658),f=n(686882),g=n(180213),m=n(245618),P=n(552154),y=n(498395);const A=(0,a.Z)("img",{target:"e1d8srj50"})("height:140px;object-fit:cover;margin:",(({contentAppearance:e})=>e==u.X.DEFAULT?"0 auto":""),";margin-top:16px;margin-bottom:",(({isPagePreview:e})=>e?"15px":"32px"),";max-width:",(({contentAppearance:e})=>e==u.X.DEFAULT?"760px":""),";width:",(({isPagePreview:e,contentAppearance:t})=>e&&t==u.X.FULL_WIDTH?"202.5%":"100%"),";display:flex;border-radius:3px;"),h=(0,a.Z)("div",{target:"e1d8srj51"})("display:flex;flex-direction:column;align-items:center;height:140px;justify-content:center;background:",c.N20,";max-width:",(({contentAppearance:e})=>e==u.X.DEFAULT?"760px":""),";margin:",(({contentAppearance:e})=>e==u.X.DEFAULT?"0 auto":""),";margin-top:16px;margin-bottom:32px;border-radius:3px;"),E=({contentId:e,isPagePreview:t})=>{var n,a,c,f,g,E;const[D,I]=(0,r.useState)(u.X.DEFAULT),{isExternalShareRequest:b}=(0,r.useContext)(d.k),[F,L]=(0,r.useState)(null),{data:x}=(0,o.aM)(y.x,{fetchPolicy:"network-only",context:{single:!0},variables:{contentId:e,status:["current","draft"]}}),w=(null==x||null===(n=x.content)||void 0===n||null===(a=n.nodes)||void 0===a||null===(c=a[0])||void 0===c||null===(f=c.properties)||void 0===f?void 0:f.nodes)||[],C=w.find((e=>(null==e?void 0:e.key)===P.h.DRAFT)),T=w.find((e=>(null==e?void 0:e.key)===P.h.PUBLISHED)),U={draft:(0,m.q)(C),published:(0,m.q)(T)},S=t?null===(g=U.draft)||void 0===g?void 0:g.id:null===(E=U.published)||void 0===E?void 0:E.id;return(0,r.useEffect)((()=>{(0,s.Pp)({contentId:e,isExternalShare:b}).then((({viewMediaClientConfig:t})=>{L({collection:`contentId-${e}`,authProvider:t.authProvider})}))}),[e,b]),(0,r.useEffect)((()=>{const n=t?u.q.DRAFT:u.q.PUBLISHED;(0,v.Ag)(e,n,(0,l.WQ)()).then((e=>{I(e.appearance)}))}),[e,D,t]),F?r.createElement(p.q,{key:S,identifier:{mediaItemType:"file",id:S||"",collectionName:null==F?void 0:F.collection},mediaClientConfig:{authProvider:null==F?void 0:F.authProvider},apiConfig:{allowAnimated:!0,mode:"fit",upscale:!1}},(({data:e,loading:n})=>n?r.createElement(h,{contentAppearance:D},r.createElement(i.Z,{size:"large"})):e?r.createElement(A,{contentAppearance:D,isPagePreview:t,src:e.src}):null)):null};E.displayName="PageCoverPictureViewPageComponent";const D=(0,f.mv)({attribution:g.x.CONTENT_EXPERIENCE})(E)}}]);
//# sourceMappingURL=24963.C7djs2dZSy.js.map