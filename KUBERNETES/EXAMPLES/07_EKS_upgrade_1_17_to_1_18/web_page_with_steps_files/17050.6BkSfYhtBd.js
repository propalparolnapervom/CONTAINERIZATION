(self._cf=self._cf||[]).push([[17050],{617050:(e,t,n)=>{"use strict";n.d(t,{J:()=>U});var o=n(159394),a=n(454530),i=n(202784),r=n(830691),s=n(984116),l=n(435756),c=n(656485),d=n(578996),u=n(857503),f=n(367450),m=n(36200),g=n(670390),h=n(494775),p=n(639409),v=n(195833),y=n(491735),I=n(302931),k=n(669021),w=n(587939),b=n(267083),T=n(525231),S=n(146457),C=n(761766),x=n(172581),P=n(714922),$=n(165929),E=n(31557),M=n(937523);(0,m.j)("ADFRenderer");const U=(0,r.XN)((0,i.memo)((e=>{const{document:t,featureFlags:n,dataProviders:r,extensionHandlers:m={},getExtensionHandlers:U=(()=>({})),eventHandlers:H,appearance:N="comment",adfStage:F="stage0",portalRef:O,onComplete:Z,onRendered:_,renderWhenReady:j,allowStickyHeaders:B=!0,isTruncatedContent:R,maxHeight:A=43,useContentFade:D,intl:L}=e,q=(0,a.Z)(e,["document","featureFlags","dataProviders","extensionHandlers","getExtensionHandlers","eventHandlers","appearance","adfStage","portalRef","onComplete","onRendered","renderWhenReady","allowStickyHeaders","isTruncatedContent","maxHeight","useContentFade","intl"]),V=(0,E.t)();(0,i.useEffect)((()=>(t&&(0,M.a)(),_&&_(),()=>{t&&(0,M.X)()})),[e.contentId]);const{isExternalShareRequest:W}=(0,i.useContext)($.k),z=(0,i.useCallback)((({contentId:t,spaceKey:n,push:o,cloudId:a,userId:i,flags:r},s)=>{const{getDataProviders:l}=e,f={};l&&Object.assign(f,l()),t&&(f.mediaProvider=(0,b.Pp)({contentId:t,isExternalShare:W})),a&&i&&(f.mentionProvider=(0,T.Z)(a,i).then((e=>e.mentionResource)).catch((e=>Promise.reject()))),t&&(f.taskDecisionProvider=Promise.resolve(new S.Y(L,r,t))),a&&(f.emojiProvider=(0,P.T5)(d.ZP,{cloudId:a,source:"view"}),V&&(f.profilecardProvider=(0,C.t)(a,(e=>t=>[{label:L.formatMessage({id:"view.profile"}),callback:()=>{e((0,g.p)(t,null,h.b))}}])(o)))),t&&n&&(f.contextIdentifierProvider=Promise.resolve({containerId:n,objectId:t,product:"confluence"})),f.cardProvider=Promise.resolve(new c.Vj);if(Object.keys(f).length){s=s||u.Z.create({});for(const e of Object.keys(f))s.setProvider(e,f[e])}return s}),[e.getDataProviders,L]),{push:Q}=(0,i.useContext)(p.M),{spaceKey:X,contentId:J}=(0,i.useContext)(y.z),{cloudId:K,userId:G}=(0,f.D)();let Y=m;U&&(Y=Object.assign(U(),m));const ee=n&&n["confluence.frontend.fabric.renderer.table.sorting"],te=n&&n["confluence.frontend.fabric.renderer.heading.anchor"],ne=n&&n["confluence.frontend.fabric.editor.media.linking"],oe=n&&n["confluence.frontend.fabric.renderer.sticky-headers"]&&"mobile"!==N&&B,ae=n&&n["confluence.frontend.open.expand.when.following.link"],ie=n&&n["confluence.frontend.fabric.renderer-spec-based-validator"],re=!!n&&!!n["confluence.frontend.fabric.editor.codeblock.copy"],se=e=>{if(!e)return;const t=e["confluence.frontend.fabric.renderer.ttr-severity-tracking"];if("string"==typeof t)try{return JSON.parse(t)}catch(n){0}},{shimAdfUrls:le}=(0,v.f)();return t?i.createElement(s.xs,{to:[I.Q,k.S,w.f]},((a,s,d)=>{const u=s.getTotalHeight()+d.getFloatingHeight(),f=z({spaceKey:X,contentId:e.contentId?e.contentId:J,push:Q,cloudId:K,userId:G,flags:a},r);return i.createElement(c.zt,null,i.createElement(l.ZP,(0,o.Z)((0,o.Z)({enableSsrInlineScripts:Boolean(!1),adfStage:F,document:le(t),appearance:N,allowDynamicTextSizing:!1,stickyHeaders:oe&&{offsetTop:u},extensionHandlers:Y,eventHandlers:H,dataProviders:f,portal:O||void 0,onComplete:Z,allowColumnSorting:ee,allowHeadingAnchorLinks:ae?{allowNestedHeaderLinks:te,activeHeadingId:e.queryHash}:te,allowAltTextOnImages:!0,media:{allowLinking:ne,featureFlags:(0,x.N)(n)},allowCopyToClipboard:re},q),{},{useSpecBasedValidator:ie,truncated:R,maxHeight:A,fadeOutHeight:D?35:0,analyticsEventSeverityTracking:se(n)})),j&&j())})):null})))},937523:(e,t,n)=>{"use strict";n.d(t,{a:()=>i,X:()=>r});var o=n(38932);const a=e=>{if(!e.isUserCollection)return fetch("/wiki/rest/internal/1.0/eventnotifier/notify",{method:"POST",body:JSON.stringify({attachmentViewed:{fileStoreId:e.fileId}}),headers:{"Content-Type":"application/json"}})},i=()=>{o.h.on("media-viewed",a)},r=()=>{o.h.off("media-viewed",a)}},587939:(e,t,n)=>{"use strict";n.d(t,{f:()=>s});var o=n(159394),a=n(151119),i=n(984116),r=n(669021);class s extends i.W2{constructor(...e){super(...e),(0,a.Z)(this,"state",{floatingBanners:[]}),(0,a.Z)(this,"showFloating",((e,t)=>{const n=(0,r.f)(e,this.state.floatingBanners);-1===n?this.setState((n=>{const a=[...n.floatingBanners];return a.push({name:e,height:t}),(0,o.Z)((0,o.Z)({},n),{},{floatingBanners:a})})):this.state.floatingBanners[n].height!==t&&this.setState((e=>{const a=[...e.floatingBanners];return a[n].height=t,(0,o.Z)((0,o.Z)({},e),{},{floatingBanners:a})}))})),(0,a.Z)(this,"hideFloating",(e=>{const t=(0,r.f)(e,this.state.floatingBanners);t>-1&&this.setState((e=>{const n=[...e.floatingBanners];return n.splice(t,1),(0,o.Z)((0,o.Z)({},e),{},{floatingBanners:n})}))})),(0,a.Z)(this,"getFloatingHeightBefore",(e=>{const t=(0,r.f)(e,this.state.floatingBanners);return-1===t?0:this.state.floatingBanners.slice(0,t).reduce(((e,t)=>e+t.height),0)})),(0,a.Z)(this,"getFloatingHeight",(()=>this.state.floatingBanners.reduce(((e,t)=>e+t.height),0)))}}},267083:(e,t,n)=>{"use strict";n.d(t,{Xj:()=>P,Pp:()=>x,hx:()=>C});var o=n(159394),a=n(38932),i=n(846575),r=n(230382),s=n.n(r);const l=s()`mutation FileUploadMutation($size:Int!$contentType:String!$mimeType:String!$fileName:String!$pageId:String!$fileStoreId:String!$minorEdit:Boolean$renderEditorHTML:Boolean$collectionName:String!)@experimental{experimentalFileUpload(size:$size contentType:$contentType mimeType:$mimeType fileName:$fileName pageId:$pageId fileStoreId:$fileStoreId minorEdit:$minorEdit renderEditorHTML:$renderEditorHTML collectionName:$collectionName)}`,c=s()`query MediaDownloadTokenQuery($contentId:ID!$status:[String]){content(id:$contentId status:$status){nodes{id body{atlas_doc_format{mediaToken{token}}}}}mediaConfiguration{clientId fileStoreUrl}}`,d=s()`query ExternalShareMediaDownloadTokenQuery($contentId:ID!){singleContent(id:$contentId){id body{atlas_doc_format{mediaToken{token}}}}mediaConfiguration{clientId fileStoreUrl}}`,u=s()`query MediaUploadTokenQuery($contentId:ID!){contentMediaSession(contentId:$contentId){token{value}configuration{clientId fileStoreUrl}collection mediaPickerUserToken{id token}}}`,f=async e=>(0,i.WQ)().query({query:c,variables:{contentId:e,status:["current","draft","archived"]},context:{allowOnExternalPage:!0},fetchPolicy:"network-only"}),m=async e=>(0,i.WQ)().query({query:u,variables:{contentId:e},fetchPolicy:"no-cache"});var g=n(703157);const h=()=>{},p=e=>e.contentId&&e.contentType?t=>{const{id:n,name:o,size:a,mimeType:r}=t,{contentId:s,contentType:c}=e;(e=>{(0,i.WQ)().mutate({mutation:l,variables:e})})({size:a,contentType:c,mimeType:r,fileName:o,pageId:s,fileStoreId:n,minorEdit:!0,renderEditorHTML:!1,collectionName:`contentId-${s}`})}:h,v=54e4,y=(0,g.O)((async e=>{var t,n,o,a,r,s,l,c,u,m,g,h,p;const v=await(e.isExternalShare?(async e=>(0,i.WQ)().query({query:d,variables:{contentId:e},context:{allowOnExternalPage:!0},fetchPolicy:"network-only"}))(e.contentId):f(e.contentId));return{token:(e.isExternalShare?null==v||null===(t=v.data)||void 0===t||null===(n=t.singleContent)||void 0===n||null===(o=n.body)||void 0===o||null===(a=o.atlas_doc_format)||void 0===a||null===(r=a.mediaToken)||void 0===r?void 0:r.token:null==v||null===(s=v.data)||void 0===s||null===(l=s.content)||void 0===l||null===(c=l.nodes)||void 0===c||null===(u=c[0])||void 0===u||null===(m=u.body)||void 0===m||null===(g=m.atlas_doc_format)||void 0===g||null===(h=g.mediaToken)||void 0===h?void 0:h.token)||"",config:(null==v||null===(p=v.data)||void 0===p?void 0:p.mediaConfiguration)||{}}}),v),I=e=>async()=>{const t=await e();return{token:t.token||"",clientId:t.config.clientId||"",baseUrl:t.config.fileStoreUrl||""}},k=async e=>{var t,n,o,a,i,r,s;const l=await f(e),{clientId:c="",fileStoreUrl:d=""}=(null==l||null===(t=l.data)||void 0===t?void 0:t.mediaConfiguration)||{};return{clientId:c,token:(null==l||null===(n=l.data)||void 0===n||null===(o=n.content)||void 0===o||null===(a=o.nodes)||void 0===a||null===(i=a[0])||void 0===i||null===(r=i.body)||void 0===r||null===(s=r.atlas_doc_format)||void 0===s?void 0:s.mediaToken.token)||"",baseUrl:d||""}},w=(0,g.O)((async e=>{var t,n;const o=await m(e.contentId),a=(null==o||null===(t=o.data)||void 0===t?void 0:t.contentMediaSession)||{};return{token:(null==a||null===(n=a.token)||void 0===n?void 0:n.value)||"",config:(null==a?void 0:a.configuration)||{},collectionId:(null==a?void 0:a.collection)||""}}),v),b=(0,g.O)((async e=>{var t,n;const o=await m(e.contentId),a=(null==o||null===(t=o.data)||void 0===t?void 0:t.contentMediaSession)||{},i=(null==a||null===(n=a.configuration)||void 0===n?void 0:n.fileStoreUrl)||"",r=(null==a?void 0:a.mediaPickerUserToken)||{};return{token:r.token||"",config:{fileStoreUrl:i,clientId:r.id||""}}}),354e4),T=async e=>(await w.getValue(e)).collectionId,S=async e=>{const t=await b.getValue(e);return(0,o.Z)((0,o.Z)({authProvider:I((()=>w.getValue(e)))},t.token?{userAuthProvider:I((()=>Promise.resolve(t)))}:{}),{},{getAuthFromContext:k})},C=async e=>({authProvider:I((async()=>{let t=await y.getValue(e);return t.token||(t=await y.forceGetValue(e)),t})),getAuthFromContext:k}),x=async e=>({viewMediaClientConfig:await C(e)}),P=async e=>{E(e);const[t,n,o]=await Promise.all([C(e),S(e),T(e)]);return{viewMediaClientConfig:t,uploadParams:{collection:o},uploadMediaClientConfig:n}};let $;const E=e=>{$&&a.h.off("file-added",$),$=p(e),a.h.on("file-added",$)}},703157:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});var o=n(818149),a=n.n(o);const i=[-1/0,null,null],r=(e,t)=>{const n={};function o(o,r){const s=Date.now();let l="";try{l=JSON.stringify(o)}catch(f){0}const[c,d,u]=n[l]||i;if(r||c+t<=s||!a()(d,o)){const t=e(o);return n[l]=[s,o,t],t}return u}return{forceGetValue:e=>o(e,!0),getValue:e=>o(e,!1)}}},525231:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var o=n(970796);function a(e,t,n,a){return(0,o.vv)(e,t,n,a)}},154118:(e,t,n)=>{"use strict";n.d(t,{R:()=>m});var o=n(151119),a=n(452973),i=n(319121),r=n(275153),s=n(929796),l=n(164464);const c="initialState",d="searchUser",u="succeeded",f="failed";class m extends a.ZP{constructor(e,t,n){super(t),(0,o.Z)(this,"userTeamEndpoint",void 0),(0,o.Z)(this,"teamMentionConfig",void 0),this.teamMentionConfig=n,this.userTeamEndpoint=e}async remoteInitialState(e){try{const t=await this.doSearch("",e);return this._notifyAnalyticsListeners(i.oX,c,u),t}catch(t){throw this._notifyAnalyticsListeners(i.oX,c,f),t}}async remoteSearch(e,t){try{const n=await this.doSearch(e,t);return this._notifyAnalyticsListeners(i.oX,d,u),n}catch(n){throw this._notifyAnalyticsListeners(i.oX,d,f),n}}mentionTypeaheadHighlightEnabled(){return this.teamMentionConfig.teamHighlightEnabled||!1}mentionTypeaheadCreateTeamPath(){return this.teamMentionConfig.createTeamPath}async doSearch(e,t){const n=await this.post(await this.cloudId(),e,t);if(!n.ok){const e=await n.json();throw new Error(JSON.stringify(e))}return{query:e,mentions:(await n.json()).recommendedUsers.map((e=>this.isUser(e)?this.convertToUserMention(e):(this.isTeam(e),this.convertToTeamMention(e))))}}async cloudId(){const e=await(0,l.g)(),{cloudId:t}=e;return t}async post(e,t,n){return await(0,s.y)(this.userTeamEndpoint,{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({context:{contextType:"Mentions",principalId:"context",productKey:n&&n.product||"confluence",siteId:e,containerId:n&&n.containerId,objectId:n&&n.objectId,childObjectId:n&&n.childObjectId,mentionsSessionId:n&&n.sessionId},searchQuery:{queryString:t},maxNumberOfResults:20,includeTeams:!0})})}isUser(e){return"USER"===e.entityType}convertToUserMention(e){return{id:e.id,name:e.name||e.nickname||"",mentionName:e.nickname||"",avatarUrl:e.avatarUrl,accessLevel:e.accessLevel,userType:e.userType}}isTeam(e){return"TEAM"===e.entityType}convertToTeamMention(e){const{teamLinkResolver:t}=this.teamMentionConfig;let n="";const o=`${window.location.origin}/people/team/${e.id}`;return"function"==typeof t&&(n=t(e.id)),{id:e.id,name:e.displayName,mentionName:e.displayName,avatarUrl:e.smallAvatarImageUrl,accessLevel:r.kI[r.kI.CONTAINER],userType:r.FW[r.FW.TEAM],context:{members:e.members,includesYou:e.includesYou,memberCount:e.memberCount,teamLink:n||o}}}}},970796:(e,t,n)=>{"use strict";n.d(t,{OC:()=>f,vv:()=>m});var o=n(164464),a=n(180589),i=n(280614),r=n(214765),s=n(494775),l=n(275153),c=n(929796);class d{getLookupLimit(){return 100}async lookupMentionNames(e){const t=e.reduce(((e,t,n)=>`${e}${n>0?"&":""}accountId=${encodeURIComponent(t)}`),"");return(0,c.y)(`/wiki/rest/api/user/bulk?${t}`,{credentials:"same-origin"}).then((e=>e.json())).then((e=>e&&e.results&&e.results.length?e.results.map((e=>({id:e.accountId,name:e.displayName,status:l.dP.OK}))):[]))}}var u=n(154118);async function f(e,t,n,r){const l={url:`/gateway/api/mentions/${e}`,productId:"micros-group/confluence",containerId:t||void 0,shouldHighlightMention:e=>e.id===n},{featureFlags:c}=await(0,o.g)(),f=c["confluence.frontend.people.directory"]?s.b:"",m={url:"/gateway/api/teams/mentions",productId:"micros-group/confluence",shouldHighlightMention:e=>e.id===n,teamHighlightEnabled:Boolean(c["confluence.frontend.fabric.editor.team.mention.spotlight"]),createTeamPath:`${f}/people/search#createTeam`};return l.mentionNameResolver=new a.j(new d,r),c["confluence.frontend.fabric.editor.userteam.mention"]?function(e,t){return new u.R("/gateway/api/v1/recommendations",e,t)}(l,m):new i.Z(l,m)}async function m(e,t,n,o){var a,i,s;if(!e)throw new Error("MentionResource cannot be configured without a cloud id");const l=(null!=(s=n)?s.spaceId:s)||void 0;return{mentionResource:await f(e,l,t,o),presenceResource:new r.ZP({url:"/gateway/api/directory/graphql",cloudId:e,productId:"confluence"}),mentionServiceUrl:`/gateway/api/mentions/${e}`,contextIdentifier:{containerId:l||"",objectId:(null!=(i=n)?i.contentId:i)||"",childObjectId:(null!=(a=n)?a.commentId:a)||""}}}},761766:(e,t,n)=>{"use strict";n.d(t,{t:()=>a});var o=n(523507);function a(e,t){return Promise.resolve({cloudId:e,resourceClient:(0,o.F)(),getActions:t})}},146457:(e,t,n)=>{"use strict";n.d(t,{Y:()=>l});var o=n(151119),a=n(846575),i=n(230382);const r=n.n(i)()`mutation SetTaskStatusMutation($contentId:ID!$taskId:ID!$status:TaskStatus!){setTaskStatus(inlineTasksInput:{cid:$contentId taskId:$taskId status:$status trigger:VIEW_PAGE}){success}}`;const s=(0,n(830691).vU)({flagTitle:{id:"fabric-media-support.tasklist.error.flag.title",description:"Flag title to inform user that an attempt to toggle a tasklist checkbox failed",defaultMessage:"Something went wrong"},flagDescription:{id:"fabric-media-support.tasklist.error.flag.description",description:"Flag description to inform user that an attempt to toggle a tasklist checkbox failed",defaultMessage:"An error occurred while trying to change a task's status. Please try again later."}});class l{constructor(e,t,n,a){this.intl=e,this.flags=t,this.contentId=n,this.toggleTaskCallback=a,(0,o.Z)(this,"_toggleTaskCallback",void 0),this._toggleTaskCallback=a}toggleTask(e,t){return this._toggleTaskCallback?(this._toggleTaskCallback(e,t),Promise.resolve(t)):(0,a.WQ)().mutate({mutation:r,variables:{contentId:this.contentId,taskId:e.localId,status:"DONE"===t?"CHECKED":"UNCHECKED"}}).then((e=>{var n;return(null!=(n=e)&&null!=(n=n.data)&&null!=(n=n.setTaskStatus)?n.success:n)||!1||this.showErrorFlag(),t})).catch((e=>{this.showErrorFlag()}))}showErrorFlag(){this.flags.showErrorFlag({title:this.intl.formatMessage(s.flagTitle),description:this.intl.formatMessage(s.flagDescription)})}notifyRecentUpdates(e){}subscribe(e,t){}unsubscribe(e,t){}unsubscribeRecentUpdates(e){}}},172581:(e,t,n)=>{"use strict";function o(e){return e?{newCardExperience:Boolean(e["confluence.frontend.media.cards.new.experience"]),zipPreviews:Boolean(e["confluence.frontend.media.viewer.zip.previews"]),codeViewer:Boolean(e["confluence.frontend.media.viewer.code.viewer"]),folderUploads:Boolean(e["confluence.frontend.media.picker.folder.uploads"]),captions:Boolean(e["confluence.frontend.fabric.editor.media.captions"]),poll_intervalMs:Number(e["confluence.frontend.media.poll.intervalms"]),poll_maxAttempts:Number(e["confluence.frontend.media.poll.maxattempts"]),poll_backoffFactor:Number(e["confluence.frontend.media.poll.backoff.factor"]),poll_maxIntervalMs:Number(e["confluence.frontend.media.poll.maxIntervalms"]),poll_maxGlobalFailures:Number(e["confluence.frontend.media.poll.max.global.failures"])}:{}}n.d(t,{N:()=>o})},714922:(e,t,n)=>{"use strict";n.d(t,{bJ:()=>r,T5:()=>s});var o=n(830733),a=n.n(o);(0,n(36200).j)("emoji-provider");const i="/gateway/api/emoji",r=(e,t)=>{const n={providers:[{url:`${i}/standard`},{url:`${i}/atlassian`}],allowUpload:!0,currentUser:t?{id:t}:void 0};return e&&n.providers.push({url:`${i}/${e}/site`}),n},s=a()(((e,t)=>{var n,o;const a=null!==(n=null==t?void 0:t.cloudId)&&void 0!==n?n:"",i=null!==(o=null==t?void 0:t.userId)&&void 0!==o?o:void 0,s=r(a,i);let l;try{l=new e(s)}catch(c){0}return Promise.resolve(l)}),((e,t)=>{var n,o;return`${null!==(n=null==t?void 0:t.cloudId)&&void 0!==n?n:""}_${null!==(o=null==t?void 0:t.source)&&void 0!==o?o:""}`}))}}]);
//# sourceMappingURL=17050.6BkSfYhtBd.js.map