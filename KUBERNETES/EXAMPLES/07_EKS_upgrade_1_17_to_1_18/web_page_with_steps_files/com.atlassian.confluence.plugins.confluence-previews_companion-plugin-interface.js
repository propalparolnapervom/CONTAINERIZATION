WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-previews:companion-plugin-interface', location = 'js/component/companion/confluence-companion-interface.js' */
define("cp/component/companion/confluence-companion-interface",["jquery","MediaViewer","cp/service/service-helpers","confluence/api/constants","confluence/meta",],function(e,d,f,b,c){var a=d.require("core/file");return{asapFetcher:function(){return new Promise(function(g){e.ajax({url:b.CONTEXT_PATH+"/rest/cp/latest/companion/asap/header",type:"POST",contentType:"application/json"}).done(function(h){g(h.substring(7))})})},getDownloadURLFromFile:function(h,g){e.get(b.CONTEXT_PATH+"/rest/internals/1.0/media/downloadURL?fileId="+h.get("id")+"&fileName="+h.get("title")+"&pageId="+parseInt(c.get("page-id"),10)+"&draftId="+(c.get("draft-id")?parseInt(c.get("draft-id"),10):0)+"&dragAndDropEntityId="+(c.get("drag-and-drop-entity-id")||0)).done(function(i){g(i)})},getUploadTokenFromFile:function(h,g){e.get(b.CONTEXT_PATH+"/rest/internals/1.0/media/uploadToken?spaceKey="+c.get("space-key")).done(function(i){g(i)})},registerNewVersionOfFile:function(i,l,h){var k={};var g=parseInt(c.get("page-id"),10);if(g){k.pageId=g}else{k.draftId=parseInt(c.get("draft-id"),10)}var j=c.get("drag-and-drop-entity-id");if(j){k.dragAndDropEntityId=j}Object.assign(k,{fileStoreId:l.id,fileName:i.get("title"),mimeType:i.get("type"),size:l.size,minorEdit:true});e.ajax({type:"POST",url:b.CONTEXT_PATH+"/rest/drag-and-drop/1/filestore/upload",data:JSON.stringify(k),contentType:"application/json"}).done(function(){e.ajax({type:"POST",url:b.CONTEXT_PATH+"/rest/files/1.0/files/content/"+i.get("ownerId")+"/byAttachmentIds",data:JSON.stringify({attachmentIds:[i.get("id")]}),contentType:"application/json"}).done(function(m){h._fileState.replaceCurrent(new a(f.responseToFile(m.results[0])));h.showFile(h._fileState.getCurrent());h._fileState.set("isNewFileUploaded",true)})})}}});
}catch(e){WRMCB(e)};